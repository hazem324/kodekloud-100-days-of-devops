# Execute Rollback in Kubernetes Cluster

Earlier today, the Nautilus DevOps team deployed a new release for an application. However, a customer reported a bug related to this release. The objective was to revert the deployment to the previous stable revision.

There is an existing deployment named `nginx-deployment`.

---

## Objective

Rollback the deployment **nginx-deployment** to its previous revision.

---

## Steps

### 1. Verify Deployment Exists

```sh
kubectl get deploy
```

Output:

```
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3/3     3            3           79s
```

This confirms the deployment is running.

### 2. Execute Rollback

To revert to the previous revision:

```sh
kubectl rollout undo deployment/nginx-deployment
```

Output:

```
deployment.apps/nginx-deployment rolled back
```

This confirms that the rollback operation was triggered successfully.

### 3. Verify Rollout Status

```sh
kubectl rollout status deployment/nginx-deployment
```
[![ Verify Rollout Status](../screenshots/Screenshot-day-52-rollout-verify.png)](../screenshots/Screenshot-day-52-rollout-verify.png)

---

# Good to Know

##  Rollout vs Rollback

* **Rollout** â†’ Deploy a new version of an application.
* **Rollback** â†’ Revert to a previous stable version.
* Kubernetes automatically stores revision history for Deployments.

---

##  How Kubernetes Tracks Revisions

* Each change in a Deployment creates a new **ReplicaSet**.
* ReplicaSets are versioned automatically.
* Old ReplicaSets are kept (by default) for rollback purposes.
* You can control this behavior using:

```yaml
revisionHistoryLimit: 10
```

If set to `0`, rollback will not be possible.

---

##  Common Rollout Commands

| Operation                     | Command                                                            |
| ----------------------------- | ------------------------------------------------------------------ |
| Check rollout status          | `kubectl rollout status deployment/nginx-deployment`               |
| View revision history         | `kubectl rollout history deployment/nginx-deployment`              |
| Rollback to previous revision | `kubectl rollout undo deployment/nginx-deployment`                 |
| Rollback to specific revision | `kubectl rollout undo deployment/nginx-deployment --to-revision=2` |
| Restart deployment            | `kubectl rollout restart deployment/nginx-deployment`              |

---

##  When Should You Rollback?

Rollback is commonly used when:

* Application crashes after deployment
* Health checks fail
* High error rate detected
* Performance degradation
* Incorrect configuration (env variables, image tag, etc.)

---

##  Deep Verification Commands

To inspect what changed between revisions:

```sh
kubectl rollout history deployment/nginx-deployment --revision=2
```

To inspect ReplicaSets:

```sh
kubectl get rs
```

To inspect Pod image version:

```sh
kubectl describe pod <pod-name>
```

---

## ðŸ§  Production Insight

* Rollbacks are safe only if previous versions are stable.
* Always use proper **image tagging** (avoid `latest` in production).
* Use `--record` flag to track change cause:

```sh
kubectl set image deployment/nginx-deployment nginx=nginx:1.25 --record
```

* Combine rollouts with readiness/liveness probes for safer deployments.
