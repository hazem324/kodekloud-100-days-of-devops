# âš–ï¸ Configure NGINX Load Balancer (High Availability Setup)

Day by day traffic was increasing on one of the websites managed by the **Nautilus production support team**, causing performance degradation.
To improve availability and scalability, the application was migrated to a **high availability architecture** in **Stratos DC**.

The final pending task was to configure the **LBR (Load Balancer) server** using **NGINX**, while keeping Apache unchanged on all application servers.

---

## ğŸ› ï¸ Steps to Fix the Task

### 1ï¸âƒ£ Enable and Verify Apache on All App Servers

Login to **App Server 1, App Server 2, and App Server 3** and ensure Apache (`httpd`) is running.

```bash
sudo systemctl start httpd
sudo systemctl enable httpd
systemctl status httpd
```

ğŸ“¸ **Screenshot â€“ Apache Service Running on App Server**
*(Screenshot http-server-status-serverapp)*

---

### 2ï¸âƒ£ Identify the Apache Listening Port

Since the task explicitly states **not to change the Apache port**, we must first verify which port Apache is already using.

```bash
sudo ss -lntp | grep httpd
```

âœ… Result observed:

* Apache is listening on **port 3004**
* Same configuration on all app servers

ğŸ“¸ **Screenshot â€“ Apache Listening Port Verification**
*(Screenshot showing ss -lntp output)*

---

### 3ï¸âƒ£ Install and Start NGINX on the LBR Server

Login to the **LBR server** and install NGINX.

```bash
sudo yum install -y nginx
sudo systemctl enable nginx
sudo systemctl start nginx
```

Verify NGINX status:

```bash
systemctl status nginx
```

ğŸ“¸ **Screenshot â€“ NGINX Service Running on LBR Server**
*(Screenshot nginx-status-running-in-LBS-server)*

---

### 4ï¸âƒ£ Configure Load Balancing in `/etc/nginx/nginx.conf`

âš ï¸ **Important:**
Only the **main NGINX configuration file** was modified, as required by the task.

Edit the file:

```bash
sudo nano /etc/nginx/nginx.conf
```

#### ğŸ”¹ Upstream Configuration (Backend Servers)

```nginx
upstream backend_servers {
    server stapp01:3004;
    server stapp02:3004;
    server stapp03:3004;
}
```

**Explanation:**

* Defines a pool of backend application servers
* Uses the **existing Apache port (3004)**
* Enables **round-robin load balancing** by default

---

#### ğŸ”¹ Server and Proxy Configuration

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name _;
    root /usr/share/nginx/html;

    location / {
        proxy_pass http://backend_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_connect_timeout 5s;
        proxy_read_timeout 60s;
    }
}
```

**Explanation of Key Directives:**

* `proxy_pass` â†’ forwards requests to backend app servers
* `Host` header â†’ preserves original domain name
* `X-Real-IP` â†’ keeps the real client IP
* `X-Forwarded-For` â†’ tracks request path across proxies
* `proxy_connect_timeout` â†’ avoids hanging connections
* `proxy_read_timeout` â†’ controls backend response wait time

---

### 5ï¸âƒ£ Validate and Reload NGINX Configuration

Check syntax:

```bash
sudo nginx -t
```

Reload NGINX:

```bash
sudo systemctl reload nginx
```

ğŸ“¸ **Screenshot â€“ NGINX Configuration Syntax Check**
*(Screenshot Check syntax-nginx.conf)*

---

### 6ï¸âƒ£ Final Testing

* Access the application using the **StaticApp** button
* Confirm the page loads successfully
* Requests are now distributed across all app servers

ğŸ“¸ **Screenshot â€“ Final Application Access via Load Balancer**
*(Screenshot finel-test)*

---

## â„¹ï¸ Good to Know

### ğŸ”¹ Load Balancing Basics

* **Purpose:** Distribute incoming traffic across multiple servers
* **Benefits:** High availability, scalability, fault tolerance
* **Default Algorithm:** Round-robin

### ğŸ”¹ NGINX Load Balancer Concepts

* **Upstream Block:** Defines backend server pool
* **Proxy Pass:** Forwards client requests to backends
* **Health Handling:** Automatically skips unreachable servers

### ğŸ”¹ Why Apache Port Was Not Changed

* Task requirement explicitly forbids changing Apache configuration
* Load balancer must adapt to backend, not the opposite
* Ensures minimal impact on existing services

### ğŸ”¹ High Availability Outcome

* Single entry point (LBR server)
* Multiple backend servers
* No single point of failure
* Improved performance under high traffic